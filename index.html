<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Plano Terapêutico - UTI Hospital São José</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ESTILOS GERAIS */
        :root {
            --azul-hospital: #1a5fb4;
            --verde-uti: #26a269;
            --vermelho-alerta: #c01c28;
            --amarelo-atenção: #f5a524;
            --cinza-claro: #f6f5f4;
            --cinza-escuro: #241f31;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--cinza-escuro);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* HEADER */
        .header {
            background: linear-gradient(to right, var(--azul-hospital), var(--verde-uti));
            color: white;
            padding: 25px;
            border-radius: 15px 15px 0 0;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        /* NAVEGAÇÃO */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin-bottom: 0;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--cinza-escuro);
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab.active {
            background: white;
            color: var(--azul-hospital);
            border-bottom: 3px solid var(--azul-hospital);
        }
        
        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }
        
        /* CONTEÚDO DAS ABAS */
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            min-height: 600px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* FORMULÁRIO */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-section {
            background: var(--cinza-claro);
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid var(--azul-hospital);
        }
        
        .section-title {
            color: var(--azul-hospital);
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--azul-hospital);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 95, 180, 0.2);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        /* SAPS CALCULATOR */
        .saps-calculator {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .saps-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .saps-result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid var(--verde-uti);
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
        }
        
        /* EQUIPE */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .team-member {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #dee2e6;
            text-align: center;
            transition: all 0.3s;
        }
        
        .team-member:hover {
            border-color: var(--azul-hospital);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .signature-box {
            height: 100px;
            border-bottom: 2px solid #000;
            margin-top: 15px;
            position: relative;
        }
        
        .signature-label {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            font-size: 0.9rem;
            color: #666;
        }
        
        /* BOTÕES */
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--azul-hospital), #2c82e0);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--verde-uti), #2ec27e);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* LISTA DE PLANOS */
        .planos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .plano-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .plano-card:hover {
            border-color: var(--azul-hospital);
            transform: translateY(-5px);
        }
        
        .plano-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .plano-id {
            background: var(--azul-hospital);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        /* VISUALIZAÇÃO DO PLANO */
        .plano-view {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            line-height: 1.8;
        }
        
        .plano-section-view {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        /* ALERTAS */
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
        }
        
        .alert-info {
            background: #e8f4fd;
            border-left-color: var(--azul-hospital);
            color: #1c4e80;
        }
        
        /* RESPONSIVO */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* IMPRESSÃO */
        @media print {
            .no-print, .nav-tabs, .btn-group {
                display: none !important;
            }
            
            .plano-view {
                box-shadow: none !important;
                padding: 0 !important;
            }
            
            body {
                background: white !important;
                padding: 0 !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- CABEÇALHO -->
        <header class="header">
            <h1><i class="fas fa-heartbeat"></i> Sistema de Plano Terapêutico - UTI Hospital São José</h1>
            <p>Planejamento multidisciplinar individualizado | Baseado em evidências científicas</p>
        </header>
        
        <!-- ABA DE NAVEGAÇÃO -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="openTab('novo-plano')">
                <i class="fas fa-plus-circle"></i> Novo Plano
            </button>
            <button class="nav-tab" onclick="openTab('meus-planos')">
                <i class="fas fa-list"></i> Meus Planos
            </button>
            <button class="nav-tab" onclick="openTab('visualizar-plano')">
                <i class="fas fa-eye"></i> Visualizar
            </button>
            <button class="nav-tab" onclick="openTab('instrucoes')">
                <i class="fas fa-question-circle"></i> Instruções
            </button>
        </div>
        
        <!-- ABA 1: NOVO PLANO -->
        <div id="novo-plano" class="tab-content active">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 
                <strong>Importante:</strong> Preencha todos os campos obrigatórios (*). Os dados são salvos automaticamente no seu navegador.
            </div>
            
            <form id="formPlano">
                <!-- DADOS DO PACIENTE -->
                <div class="section-title">
                    <i class="fas fa-user-injured"></i> Dados do Paciente
                </div>
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" class="form-control" id="nome" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Idade (anos) *</label>
                            <input type="number" class="form-control" id="idade" min="0" max="120" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sexo *</label>
                            <select class="form-control" id="sexo" required>
                                <option value="">Selecione...</option>
                                <option value="M">Masculino</option>
                                <option value="F">Feminino</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Leito *</label>
                            <input type="text" class="form-control" id="leito" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data de Admissão *</label>
                            <input type="date" class="form-control" id="dataAdmissao" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Registro Hospitalar</label>
                            <input type="text" class="form-control" id="registro">
                        </div>
                    </div>
                </div>
                
                <!-- DIAGNÓSTICO E HISTÓRIA -->
                <div class="section-title">
                    <i class="fas fa-stethoscope"></i> Avaliação Clínica
                </div>
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Diagnóstico Principal *</label>
                            <textarea class="form-control" id="diagnostico" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">História Pregressa</label>
                            <textarea class="form-control" id="historia" rows="4" 
                                placeholder="Comorbidades, cirurgias prévias, alergias, medicações em uso..."></textarea>
                        </div>
                    </div>
                    
                    <!-- SAPS III -->
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Calculadora SAPS III</label>
                            <div class="saps-calculator">
                                <div class="saps-inputs">
                                    <input type="number" class="form-control" id="sapsIdade" placeholder="Idade">
                                    <input type="number" class="form-control" id="sapsPas" placeholder="PAS (mmHg)">
                                    <input type="number" class="form-control" id="sapsFc" placeholder="FC (bpm)">
                                    <input type="number" class="form-control" id="sapsTemp" step="0.1" placeholder="Temp (°C)">
                                    <input type="number" class="form-control" id="sapsPaO2" placeholder="PaO₂/FiO₂">
                                    <input type="number" class="form-control" id="sapsGlasgow" min="3" max="15" placeholder="Glasgow">
                                    <input type="number" class="form-control" id="sapsBilirrubina" step="0.1" placeholder="Bilirrubina">
                                    <input type="number" class="form-control" id="sapsLeucocitos" placeholder="Leucócitos">
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="calcularSAPS()" style="width: 100%; margin-bottom: 15px;">
                                    <i class="fas fa-calculator"></i> Calcular SAPS III
                                </button>
                                <div id="sapsResultado" class="saps-result">
                                    SAPS III: -- | Mortalidade estimada: --%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- METAS TERAPÊUTICAS -->
                <div class="section-title">
                    <i class="fas fa-bullseye"></i> Metas Terapêuticas
                </div>
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Meta Terapêutica Diária *</label>
                            <textarea class="form-control" id="metaDiaria" rows="4" required 
                                placeholder="Ex: 1. Controle hemodinâmico (PAM > 65mmHg)&#10;2. Normalização do lactato&#10;3. Otimização da ventilação"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Obejtivo Terapêutico Anterior</label>
                            <textarea class="form-control" id="metaAnterior" rows="3"
                                placeholder="Metas estabelecidas na avaliação anterior"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pendências</label>
                            <textarea class="form-control" id="pendencias" rows="3"
                                placeholder="Exames pendentes, avaliações necessárias, intervenções a realizar..."></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- EQUIPE MULTIPROFISSIONAL -->
                <div class="section-title">
                    <i class="fas fa-users"></i> Equipe Multiprofissional
                </div>
                <div class="team-grid">
                    <!-- MÉDICO -->
                    <div class="team-member">
                        <h4><i class="fas fa-user-md"></i> Médico Intensivista</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura e CRM</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do médico" style="margin-top: 10px;">
                    </div>
                    
                    <!-- ENFERMAGEM -->
                    <div class="team-member">
                        <h4><i class="fas fa-user-nurse"></i> Enfermagem</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura e COREN</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do enfermeiro" style="margin-top: 10px;">
                    </div>
                    
                    <!-- NUTRIÇÃO -->
                    <div class="team-member">
                        <h4><i class="fas fa-utensils"></i> Nutrição</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura e CRN</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do nutricionista" style="margin-top: 10px;">
                    </div>
                    
                    <!-- FISIOTERAPIA -->
                    <div class="team-member">
                        <h4><i class="fas fa-lungs"></i> Fisioterapia</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura e CREFITO</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do fisioterapeuta" style="margin-top: 10px;">
                    </div>
                    
                    <!-- CONTROLE DE INFECÇÃO -->
                    <div class="team-member">
                        <h4><i class="fas fa-bacteria"></i> Controle de Infecção</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do profissional" style="margin-top: 10px;">
                    </div>
                    
                    <!-- FARMÁCIA CLÍNICA -->
                    <div class="team-member">
                        <h4><i class="fas fa-pills"></i> Farmácia Clínica</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura e CRF</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do farmacêutico" style="margin-top: 10px;">
                    </div>
                    
                    <!-- SERVIÇO SOCIAL -->
                    <div class="team-member">
                        <h4><i class="fas fa-hands-helping"></i> Serviço Social</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura e CRESS</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do assistente social" style="margin-top: 10px;">
                    </div>
                    
                    <!-- PSICOLOGIA -->
                    <div class="team-member">
                        <h4><i class="fas fa-brain"></i> Psicologia</h4>
                        <div class="signature-box">
                            <div class="signature-label">Assinatura e CRP</div>
                        </div>
                        <input type="text" class="form-control" placeholder="Nome do psicólogo" style="margin-top: 10px;">
                    </div>
                </div>
                
                <!-- BOTÕES DE AÇÃO -->
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="salvarPlano()">
                        <i class="fas fa-save"></i> Salvar Plano
                    </button>
                    <button type="button" class="btn btn-success" onclick="visualizarPlano()">
                        <i class="fas fa-eye"></i> Visualizar Plano
                    </button>
                    <button type="button" class="btn" onclick="limparFormulario()" style="background: #6c757d; color: white;">
                        <i class="fas fa-redo"></i> Limpar Formulário
                    </button>
                    <button type="button" class="btn" onclick="imprimirPlano()" style="background: #f5a524; color: white;">
                        <i class="fas fa-print"></i> Imprimir Plano
                    </button>
                </div>
                
                <!-- ID DO PLANO (oculto) -->
                <input type="hidden" id="planoId" value="">
            </form>
        </div>
        
        <!-- ABA 2: MEUS PLANOS -->
        <div id="meus-planos" class="tab-content">
            <div class="section-title">
                <i class="fas fa-folder-open"></i> Planos Salvos
            </div>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 
                <strong>Armazenamento local:</strong> Seus planos são salvos no seu navegador. Para não perder os dados, não limpe o cache.
            </div>
            
            <div id="listaPlanos" class="planos-grid">
                <!-- Os planos serão carregados aqui via JavaScript -->
            </div>
            
            <div id="semPlanos" style="text-align: center; padding: 50px; color: #666;">
                <i class="fas fa-folder-open fa-4x" style="margin-bottom: 20px;"></i>
                <h3>Nenhum plano salvo ainda</h3>
                <p>Crie seu primeiro plano na aba "Novo Plano"</p>
            </div>
        </div>
        
        <!-- ABA 3: VISUALIZAR PLANO -->
        <div id="visualizar-plano" class="tab-content">
            <div class="section-title">
                <i class="fas fa-file-medical-alt"></i> Visualização do Plano Terapêutico
            </div>
            
            <div id="planoViewContainer">
                <div style="text-align: center; padding: 50px; color: #666;">
                    <i class="fas fa-search fa-4x" style="margin-bottom: 20px;"></i>
                    <h3>Selecione um plano para visualizar</h3>
                    <p>Vá para a aba "Meus Planos" e clique em um plano para visualizá-lo aqui</p>
                </div>
            </div>
        </div>
        
        <!-- ABA 4: INSTRUÇÕES -->
        <div id="instrucoes" class="tab-content">
            <div class="section-title">
                <i class="fas fa-book"></i> Guia de Uso do Sistema
            </div>
            
            <div class="form-section">
                <h3><i class="fas fa-play-circle"></i> Como começar</h3>
                <ol style="margin-left: 20px; margin-bottom: 25px;">
                    <li><strong>Preencha o formulário</strong> na aba "Novo Plano"</li>
                    <li><strong>Calcule o SAPS III</strong> usando os dados clínicos</li>
                    <li><strong>Clique em "Salvar Plano"</strong> para armazenar</li>
                    <li><strong>Acesse os planos salvos</strong> na aba "Meus Planos"</li>
                    <li><strong>Visualize ou edite</strong> clicando no plano desejado</li>
                    <li><strong>Imprima</strong> quando necessário</li>
                </ol>
                
                <h3><i class="fas fa-lightbulb"></i> Dicas importantes</h3>
                <ul style="margin-left: 20px; margin-bottom: 25px;">
                    <li>Os dados são salvos apenas no seu navegador</li>
                    <li>Para backup, imprima os planos importantes</li>
                    <li>Use a calculadora SAPS III para gravidade</li>
                    <li>Preencha todas as assinaturas da equipe</li>
                    <li>Atualize as metas diariamente</li>
                </ul>
                
                <h3><i class="fas fa-shield-alt"></i> Segurança e Privacidade</h3>
                <p>Este sistema funciona totalmente no seu navegador. Nenhum dado é enviado para servidores externos. Para maior segurança:</p>
                <ul style="margin-left: 20px;">
                    <li>Não inclua CPF ou dados pessoais completos</li>
                    <li>Use iniciais ou códigos para identificação</li>
                    <li>Mantenha seu navegador atualizado</li>
                    <li>Não limpe o cache do navegador se quiser manter os dados</li>
                </ul>
                
                <div class="btn-group" style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="openTab('novo-plano')">
                        <i class="fas fa-plus-circle"></i> Criar Primeiro Plano
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SISTEMA DE SALVAMENTO E LÓGICA -->
    <script>
        // VARIÁVEIS GLOBAIS
        let planosSalvos = JSON.parse(localStorage.getItem('planosUTI')) || [];
        let planoAtual = null;
        
        // INICIALIZAR SISTEMA
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar data atual
            document.getElementById('dataAdmissao').valueAsDate = new Date();
            
            // Carregar planos salvos
            carregarPlanos();
            
            // Tentar restaurar último plano editado
            const ultimoId = localStorage.getItem('ultimoPlanoEditado');
            if (ultimoId) {
                carregarPlanoParaEdicao(ultimoId);
            }
        });
        
        // FUNÇÃO PARA ALTERAR ABAS
        function openTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover active de todas as tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            
            // Ativar tab no menu
            event.currentTarget.classList.add('active');
            
            // Se for aba de visualização, atualizar
            if (tabName === 'meus-planos') {
                carregarPlanos();
            }
        }
        
        // CALCULAR SAPS III
        function calcularSAPS() {
            // Obter valores
            const idade = parseFloat(document.getElementById('sapsIdade').value) || 0;
            const pas = parseFloat(document.getElementById('sapsPas').value) || 0;
            const fc = parseFloat(document.getElementById('sapsFc').value) || 0;
            const temp = parseFloat(document.getElementById('sapsTemp').value) || 0;
            const paO2 = parseFloat(document.getElementById('sapsPaO2').value) || 0;
            const glasgow = parseFloat(document.getElementById('sapsGlasgow').value) || 15;
            const bilirrubina = parseFloat(document.getElementById('sapsBilirrubina').value) || 0;
            const leucocitos = parseFloat(document.getElementById('sapsLeucocitos').value) || 0;
            
            // Cálculo simplificado do SAPS III
            let score = 0;
            
            // Idade
            if (idade >= 80) score += 18;
            else if (idade >= 70) score += 15;
            else if (idade >= 60) score += 12;
            else if (idade >= 50) score += 8;
            else if (idade >= 40) score += 5;
            
            // Pressão Arterial Sistólica
            if (pas < 70) score += 13;
            else if (pas < 100) score += 5;
            else if (pas < 150) score += 0;
            else if (pas < 200) score += 2;
            else score += 7;
            
            // Frequência Cardíaca
            if (fc < 40) score += 11;
            else if (fc < 70) score += 2;
            else if (fc < 120) score += 0;
            else if (fc < 160) score += 4;
            else score += 9;
            
            // Temperatura
            if (temp < 35) score += 7;
            else if (temp < 38.3) score += 0;
            else score += 3;
            
            // PaO₂/FiO₂
            if (paO2 < 100) score += 11;
            else if (paO2 < 200) score += 6;
            else if (paO2 < 300) score += 3;
            
            // Escala de Glasgow
            if (glasgow < 6) score += 26;
            else if (glasgow < 9) score += 13;
            else if (glasgow < 11) score += 7;
            else if (glasgow < 14) score += 5;
            
            // Bilirrubina
            if (bilirrubina > 4) score += 9;
            else if (bilirrubina > 2) score += 4;
            
            // Leucócitos
            if (leucocitos < 1) score += 12;
            else if (leucocitos < 4) score += 5;
            else if (leucocitos < 20) score += 0;
            else score += 5;
            
            // Calcular mortalidade estimada
            const logit = -7.7631 + 0.0737 * score + 0.9971 * Math.log(score + 1);
            const mortalidade = (Math.exp(logit) / (1 + Math.exp(logit))) * 100;
            
            // Classificar risco
            let risco = 'Baixo';
            let cor = 'green';
            
            if (score >= 60) {
                risco = 'Alto';
                cor = 'red';
            } else if (score >= 45) {
                risco = 'Médio';
                cor = 'orange';
            }
            
            // Exibir resultado
            const resultado = document.getElementById('sapsResultado');
            resultado.innerHTML = `
                <div style="color: ${cor};">
                    <strong>SAPS III: ${Math.round(score)} pontos</strong><br>
                    Mortalidade estimada: ${mortalidade.toFixed(1)}%<br>
                    Classificação: ${risco} risco
                </div>
            `;
            
            return Math.round(score);
        }
        
        // SALVAR PLANO
        function salvarPlano() {
            // Validar campos obrigatórios
            const camposObrigatorios = ['nome', 'idade', 'sexo', 'leito', 'dataAdmissao', 'diagnostico', 'metaDiaria'];
            let valido = true;
            
            camposObrigatorios.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (!elemento.value.trim()) {
                    elemento.style.borderColor = 'red';
                    valido = false;
                } else {
                    elemento.style.borderColor = '';
                }
            });
            
            if (!valido) {
                alert('Por favor, preencha todos os campos obrigatórios!');
                return;
            }
            
            // Coletar dados do formulário
            const plano = {
                id: document.getElementById('planoId').value || Date.now().toString(),
                nome: document.getElementById('nome').value,
                idade: document.getElementById('idade').value,
                sexo: document.getElementById('sexo').value,
                leito: document.getElementById('leito').value,
                dataAdmissao: document.getElementById('dataAdmissao').value,
                registro: document.getElementById('registro').value,
                diagnostico: document.getElementById('diagnostico').value,
                historia: document.getElementById('historia').value,
                saps: document.getElementById('sapsResultado').innerText,
                metaDiaria: document.getElementById('metaDiaria').value,
                metaAnterior: document.getElementById('metaAnterior').value,
                pendencias: document.getElementById('pendencias').value,
                dataCriacao: new Date().toLocaleDateString('pt-BR'),
                dataAtualizacao: new Date().toLocaleDateString('pt-BR')
            };
            
            // Verificar se é edição ou novo
            const index = planosSalvos.findIndex(p => p.id === plano.id);
            
            if (index !== -1) {
                // Atualizar plano existente
                planosSalvos[index] = plano;
                alert('Plano atualizado com sucesso!');
            } else {
                // Adicionar novo plano
                planosSalvos.push(plano);
                alert('Plano salvo com sucesso!');
            }
            
            // Salvar no localStorage
            localStorage.setItem('planosUTI', JSON.stringify(planosSalvos));
            
            // Resetar formulário
            limparFormulario();
            
            // Atualizar lista
            carregarPlanos();
            
            // Ir para aba de planos
            openTab('meus-planos');
        }
        
        // CARREGAR PLANOS SALVOS
        function carregarPlanos() {
            const lista = document.getElementById('listaPlanos');
            const semPlanos = document.getElementById('semPlanos');
            
            if (planosSalvos.length === 0) {
                lista.innerHTML = '';
                semPlanos.style.display = 'block';
                return;
            }
            
            semPlanos.style.display = 'none';
            lista.innerHTML = '';
            
            // Ordenar por data mais recente
            planosSalvos.sort((a, b) => b.id - a.id);
            
            // Criar cards para cada plano
            planosSalvos.forEach(plano => {
                const card = document.createElement('div');
                card.className = 'plano-card';
                card.onclick = () => carregarPlanoParaEdicao(plano.id);
                
                card.innerHTML = `
                    <div class="plano-header">
                        <h4>${plano.nome}</h4>
                        <span class="plano-id">${plano.leito}</span>
                    </div>
                    <p><strong>Idade:</strong> ${plano.idade} anos</p>
                    <p><strong>Admissão:</strong> ${plano.dataAdmissao}</p>
                    <p><strong>Diagnóstico:</strong> ${plano.diagnostico.substring(0, 100)}${plano.diagnostico.length > 100 ? '...' : ''}</p>
                    <p><strong>Última atualização:</strong> ${plano.dataAtualizacao}</p>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn" onclick="editarPlano('${plano.id}'); event.stopPropagation();" 
                                style="padding: 8px 15px; background: var(--azul-hospital); color: white; flex: 1;">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn" onclick="visualizarPlanoCompleto('${plano.id}'); event.stopPropagation();" 
                                style="padding: 8px 15px; background: var(--verde-uti); color: white; flex: 1;">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="btn" onclick="excluirPlano('${plano.id}'); event.stopPropagation();" 
                                style="padding: 8px 15px; background: var(--vermelho-alerta); color: white;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                lista.appendChild(card);
            });
        }
        
        // EDITAR PLANO
        function editarPlano(id) {
            carregarPlanoParaEdicao(id);
            openTab('novo-plano');
        }
        
        // CARREGAR PLANO PARA EDIÇÃO
        function carregarPlanoParaEdicao(id) {
            const plano = planosSalvos.find(p => p.id === id);
            if (!plano) return;
            
            // Preencher formulário
            document.getElementById('planoId').value = plano.id;
            document.getElementById('nome').value = plano.nome || '';
            document.getElementById('idade').value = plano.idade || '';
            document.getElementById('sexo').value = plano.sexo || '';
            document.getElementById('leito').value = plano.leito || '';
            document.getElementById('dataAdmissao').value = plano.dataAdmissao || '';
            document.getElementById('registro').value = plano.registro || '';
            document.getElementById('diagnostico').value = plano.diagnostico || '';
            document.getElementById('historia').value = plano.historia || '';
            document.getElementById('metaDiaria').value = plano.metaDiaria || '';
            document.getElementById('metaAnterior').value = plano.metaAnterior || '';
            document.getElementById('pendencias').value = plano.pendencias || '';
            
            // Preencher SAPS se existir
            if (plano.saps && plano.saps.includes('SAPS III')) {
                document.getElementById('sapsResultado').innerHTML = plano.saps;
            }
            
            // Salvar referência do plano atual
            planoAtual = plano;
            localStorage.setItem('ultimoPlanoEditado', id);
        }
        
        // VISUALIZAR PLANO COMPLETO
        function visualizarPlanoCompleto(id) {
            const plano = planosSalvos.find(p => p.id === id);
            if (!plano) return;
            
            const container = document.getElementById('planoViewContainer');
            
            container.innerHTML = `
                <div class="plano-view">
                    <div style="text-align: center; margin-bottom: 40px; border-bottom: 3px solid var(--azul-hospital); padding-bottom: 20px;">
                        <h1 style="color: var(--azul-hospital);">PLANO TERAPÊUTICO SINGULAR</h1>
                        <h3>Unidade de Terapia Intensiva Adulta</h3>
                        <p style="color: #666;">Documento multidisciplinar de planejamento assistencial</p>
                    </div>
                    
                    <div class="plano-section-view">
                        <h3><i class="fas fa-user-injured"></i> DADOS DO PACIENTE</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                            <div><strong>Nome:</strong> ${plano.nome}</div>
                            <div><strong>Idade:</strong> ${plano.idade} anos</div>
                            <div><strong>Sexo:</strong> ${plano.sexo === 'M' ? 'Masculino' : 'Feminino'}</div>
                            <div><strong>Leito:</strong> ${plano.leito}</div>
                            <div><strong>Admissão:</strong> ${plano.dataAdmissao}</div>
                            <div><strong>Registro:</strong> ${plano.registro || 'Não informado'}</div>
                        </div>
                    </div>
                    
                    <div class="plano-section-view">
                        <h3><i class="fas fa-stethoscope"></i> AVALIAÇÃO CLÍNICA</h3>
                        <p><strong>Diagnóstico Principal:</strong></p>
                        <p style="background: #f8f9fa; padding: 15px; border-radius: 8px;">${plano.diagnostico}</p>
                        
                        <p style="margin-top: 20px;"><strong>História Pregressa:</strong></p>
                        <p style="background: #f8f9fa; padding: 15px; border-radius: 8px; white-space: pre-line;">${plano.historia || 'Não informada'}</p>
                        
                        <p style="margin-top: 20px;"><strong>Escore SAPS III:</strong></p>
                        <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; border-left: 5px solid var(--verde-uti);">
                            ${plano.saps || 'Não calculado'}
                        </div>
                    </div>
                    
                    <div class="plano-section-view">
                        <h3><i class="fas fa-bullseye"></i> METAS TERAPÊUTICAS</h3>
                        
                        <p><strong>Meta Terapêutica Diária:</strong></p>
                        <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; white-space: pre-line;">
                            ${plano.metaDiaria}
                        </div>
                        
                        <p><strong>Meta Anterior Proposta:</strong></p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; white-space: pre-line;">
                            ${plano.metaAnterior || 'Não informada'}
                        </div>
                        
                        <p><strong>Pendências:</strong></p>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; white-space: pre-line;">
                            ${plano.pendencias || 'Nenhuma pendência registrada'}
                        </div>
                    </div>
                    
                    <div class="plano-section-view">
                        <h3><i class="fas fa-users"></i> EQUIPE MULTIPROFISSIONAL</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div>
                                <h4><i class="fas fa-user-md"></i> Médico</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura e CRM</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4><i class="fas fa-user-nurse"></i> Enfermagem</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura e COREN</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4><i class="fas fa-utensils"></i> Nutrição</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura e CRN</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4><i class="fas fa-lungs"></i> Fisioterapia</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura e CREFITO</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4><i class="fas fa-bacteria"></i> Controle de Infecção</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4><i class="fas fa-pills"></i> Farmácia Clínica</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura e CRF</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4><i class="fas fa-hands-helping"></i> Serviço Social</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura e CRESS</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4><i class="fas fa-brain"></i> Psicologia</h4>
                                <div style="height: 80px; border-bottom: 2px solid #000; position: relative;">
                                    <div style="position: absolute; bottom: 5px; font-size: 0.9rem; color: #666;">Assinatura e CRP</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; text-align: center; color: #666;">
                        <p><strong>Data de criação:</strong> ${plano.dataCriacao} | <strong>Última atualização:</strong> ${plano.dataAtualizacao}</p>
                        <p style="font-size: 0.9rem;">Documento gerado pelo Sistema de Plano Terapêutico - UTI Adulta</p>
                    </div>
                </div>
                
                <div class="btn-group no-print" style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="imprimirPlano()">
                        <i class="fas fa-print"></i> Imprimir Plano
                    </button>
                    <button class="btn" onclick="editarPlano('${plano.id}')" style="background: #6c757d; color: white;">
                        <i class="fas fa-edit"></i> Editar Plano
                    </button>
                </div>
            `;
            
            openTab('visualizar-plano');
        }
        
        // EXCLUIR PLANO
        function excluirPlano(id) {
            if (confirm('Tem certeza que deseja excluir este plano? Esta ação não pode ser desfeita.')) {
                planosSalvos = planosSalvos.filter(p => p.id !== id);
                localStorage.setItem('planosUTI', JSON.stringify(planosSalvos));
                carregarPlanos();
                alert('Plano excluído com sucesso!');
            }
        }
        
        // LIMPAR FORMULÁRIO
        function limparFormulario() {
            document.getElementById('formPlano').reset();
            document.getElementById('planoId').value = '';
            document.getElementById('sapsResultado').innerHTML = 'SAPS III: -- | Mortalidade estimada: --%';
            document.getElementById('dataAdmissao').valueAsDate = new Date();
            planoAtual = null;
            localStorage.removeItem('ultimoPlanoEditado');
        }
        
        // VISUALIZAR PLANO ATUAL
        function visualizarPlano() {
            // Primeiro salva, depois visualiza
            if (document.getElementById('nome').value && document.getElementById('diagnostico').value) {
                salvarPlano();
                setTimeout(() => {
                    if (planoAtual) {
                        visualizarPlanoCompleto(planoAtual.id);
                    }
                }, 500);
            } else {
                alert('Preencha pelo menos nome e diagnóstico para visualizar o plano.');
            }
        }
        
        // IMPRIMIR PLANO
        function imprimirPlano() {
            window.print();
        }
        
        // EXPORTAR DADOS (BACKUP)
        function exportarDados() {
            const dataStr = JSON.stringify(planosSalvos, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup-planos-uti-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // IMPORTAR DADOS (RESTAURAR)
        function importarDados(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    planosSalvos = dados;
                    localStorage.setItem('planosUTI', JSON.stringify(planosSalvos));
                    carregarPlanos();
                    alert(`Dados importados com sucesso! ${dados.length} planos restaurados.`);
                } catch (error) {
                    alert('Erro ao importar dados. Verifique se o arquivo está correto.');
                }
            };
            
            reader.readAsText(file);
        }
    </script>
</body>
</html>
